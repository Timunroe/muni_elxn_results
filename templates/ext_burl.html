{% macro show_candidates(ward) %}
    <section class=" bb b--gray pt2 pb2 hamont-wards" id="">
        <div class="pb2 ttu">{{ ward.race }}</div>
        {% set ward_leaders = ward['results']['choiceResults']|sort(attribute='votes', reverse=True) %}
        <button class="pica-accordion fw6"> 
            {% if ward_leaders[0]['votes'] > 0 %}
            {{ ward_leaders[0]['choiceName'] }} leading,
            {% endif %}
            {{ward.statistics.closedPolls}}/{{ward.statistics.polls}} polls</button>
        <div class="pica-panel">
            <table class="collapse ba br2 b--black-10 pv2 w-100">
                <tbody>
                    <tr class="striped--light-gray">
                        <th class="tl f6 fw6 ttu pv2 ph3">Name</th>
                        <th class="tl f6 fw6 ttu pv2 ph3">Votes</th>
                        <th class="tl f6 fw6 ttu pv2 ph3">%</th>
                    </tr>
                    {% for item in ward['results']['choiceResults']|sort(attribute='votes', reverse=True) %}
                    <tr class="striped--light-gray">
                        <td class="pv2 ph3">{{ loop.index }}. {{ item.choiceName }}</td>
                        <td class="pv2 ph3">{{ item.votes }}</td>
                        <td class="pv2 ph3">{{ item.percentage }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
{% endmacro %}

{% macro show_trustees(ward) %}
    {% set leaders = ward['results']['choiceResults']|sort(attribute='votes', reverse=True) %}
    <section class="bb b--gray pt2 pb2 hamont-wards" id="">
        <div class="pb2 ttu">{{ ward.race|replace('District School Board','DSB') | replace("Hamilton-Wentworth ","HW") | replace("Catholic ","C") }}</div>
        <button class="pica-accordion fw6">
            {% if ward.results.isAcclaimed %}
            {{ leaders[0]['choiceName'] }} <span style="font-family: sans-serif; color: grey; font-size: 14px;">acclaimed</span></button>
            {% elif leaders[0]['votes'] > 0 %}
            {{ leaders[0]['choiceName'] }} leading, {{ward.statistics.closedPolls}}/{{ward.statistics.polls}} polls</button>
            {% else %}
            {{ward.statistics.closedPolls}}/{{ward.statistics.polls}} polls</button>
            {% endif %}
        <div class="pica-panel">
            <table class="collapse ba br2 b--black-10 pv2 w-100">
                <tbody>
                    <tr class="striped--light-gray">
                        <th class="tl f6 fw6 ttu pv2 ph3">Name</th>
                        <th class="tl f6 fw6 ttu pv2 ph3">Votes</th>
                        <th class="tl f6 fw6 ttu pv2 ph3">%</th>
                    </tr>
                    {% for item in leaders %}
                    <tr class="striped--light-gray">
                        <td class="pv2 ph3">{{ loop.index }}. {{ item.choiceName }}
                            {% if ward.results.isAcclaimed %}
                                <span style="font-family: sans-serif; color: grey; font-size: 14px;">acclaimed</span></td>
                            {% else %}
                                </td>
                                <td class="pv2 ph3">{{ item.votes }}</td>
                                <td class="pv2 ph3">{{ item.percentage }}</td>
                            {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
{% endmacro %}

<section id="stats_header" style="max-width: 800px; min-width: 385px; margin: 0 auto;" class="">
    <h2>BURLINGTON election results</h2>  
    <p style="margin-bottom: 0.35rem; font-size: 1.1rem;"></p>
    <!--TABS START-->
    <section class="pica-tabs">
        <!--TABS CONTROLS START-->
        <div class="pica-tab-controls">
            <div class="pica-tab-control" data-tab="1" data-tab-default="yes">Burlington Mayor</div>
            <div class="pica-tab-control" data-tab="2">Burlington Wards</div>
            <div class="pica-tab-control" data-tab="3">Trustees</div>
        </div>
        <!--TABS CONTROLS END-->
        <!--TABS PANELS START-->
        <div class="pica-tab-panels pica-sans-serif">
            <div class="pica-tab-panel" data-tab="1">
                <!-- BURLINGTON MAYOR RACE -->
                {% for ward in data['races'][0:1] %}
                    {{ show_candidates(ward) }}
                {% endfor %}
            </div>
            <div class="pica-tab-panel" data-tab="2">
                <!-- BURLINGTON WARD RACES -->
                {% for ward in data['races'][1:7] %}
                    {{ show_candidates(ward) }}
                {% endfor %}
            </div>
            <div class="pica-tab-panel" data-tab="3">             
                <!-- BURLINGTON PUBLIC BOARD RACES -->
                <h3>Public board</h3>
                {% for ward in data['races'][8:12] %}
                    {{ show_trustees(ward) }}
                {% endfor %}
                <!-- BURLINGTON CATHOLIC BOARD RACES -->
                <h3>Catholic board</h3>
                {% for ward in data['races'][12:13] %}
                    {{ show_trustees(ward) }}
                {% endfor %}
                <!-- BURLINGTON OTHER BOARD RACES -->
                <h3>French boards</h3>
                {% for ward in data['races'][-2:] %}
                    {{ show_trustees(ward) }}
                {% endfor %}
            </div>
        </div>
        <!--TABS PANELS END-->
    </section>
    <!--TABS END-->
</section>
<!--STATS HEADER END-->
