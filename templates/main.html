{% extends "layout.html" %}
{% block body %}


<section class="sans-serif" style="max-width: 800px; min-width: 385px; margin: 0 auto;">
    <form action="/" method="post">
        <p>
            <button type="submit" name="action" class="f6 link dim br2 ph3 pv2 mb2 dib white bg-red" value="fetch_cp">Fetch Hamilton Data</button>
            <button type="submit" name="action" class="f6 link dim br2 ph3 pv2 mb2 dib white bg-dark-green" value="deploy_cp">Update Hamilton Data</button>
            ||
            <button type="submit" name="action" class="f6 link dim br2 ph3 pv2 mb2 dib white bg-orange" value="fetch_manual">Fetch Burlington Data</button>
            <button type="submit" name="action" class="f6 link dim br2 ph3 pv2 mb2 dib white bg-dark-pink" value="deploy_manual">Update Burlington Data</button>
            ||
            <a class="f6 link dim br1 ph3 pv2 mb2 dib white bg-mid-gray" href="https://www.thespec.com/news-story/8654956-election-results/?previewkey=eaaaabj%2bfjhic5%2foe4xhaobrz2sozhqc5r4euttg9ivhjwhb" target="_blank">DNN Preview</a>
        </p>
    </form>

<section class="bb b--gray pt2 pb2 mb2" id="party-leaders">
    <div class="ttu">Party Leaders</div>
    <div class="flex flex-wrap pv1">
        <div class="flex w-100 w-50-ns mb2">
            <div class="w-50">
                <div class="f4 fw5">Doug Ford</div>
                <div class="f6 pv1">PC - Etobicoke North</div>
                <div class="f5">{{ data['leaders']['ford']|title }}</div>
            </div>
            <div class="w-50">
                <div class="f4 fw5">Andrea Horwath</div>
                <div class="f6 pv1">NDP - Hamilton Centre</div>
                <div class="f5">{{ data['leaders']['horwath']|title }}</div>
            </div>
        </div>
        <div class="flex w-100 w-50-ns">
            <div class="w-50">
                <div class="f4 fw5">Mike Schreiner</div>
                <div class="f6 pv1">GRN - Guelph</div>
                <div class="f5">{{ data['leaders']['schreiner']|title }}</div>
            </div>
            <div class="w-50">
                <div class="f4 fw5">Kathleen Wynne</div>
                <div class="f6 pv1">LIB - Don Valley West</div>
                <div class="f5">{{ data['leaders']['wynne']|title }}</div>
            </div>
        </div>
    </div>
</section>

<section class=" bb b--gray pt2 pb2" id="local-ridings">
    <div class="pb2 ttu">Local ridings</div>
    {% for riding in data['ridings'] %}
    <button class="pica-accordion fw6">{{ riding['name']|safe }}</button>
    <div class="pica-panel">
        <table class="collapse ba br2 b--black-10 pv2 w-100">
            <tbody>
                <tr class="striped--light-gray">
                    <th class="tl f6 fw6 ttu pv2 ph3">Party</th>
                    <th class="tl f6 fw6 ttu pv2 ph3">Candidate</th>
                    <th class="tl f6 fw6 ttu pv2 ph3">Votes</th>
                    <th class="tl f6 fw6 ttu pv2 ph3">Pct</th>
                </tr>
                {% set total = riding['candidates']|sum(attribute='votes') %}

                {% for candidate in riding['candidates']|sort(attribute='votes', reverse=True) %}
                <tr class="striped--light-gray">
                    <td class="pv2 ph3">{{ candidate['party'] }}</td>
                    <td class="pv2 ph3">{{ candidate['name'] }}</td>
                    <td class="pv2 ph3">{{ candidate['votes'] }}</td>
                    {% if candidate['votes'] != 0 %}
                    {% set pct = (candidate['votes'] / total) * 100 %}
                    <td class="pv2 ph3">{{ pct|round(1, 'common') }}</td>
                    {% else %}
                    <td class="pv2 ph3">0</td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endfor %}
</section>
</section>





<h1>Hamilton municipal election results</h1>

{% set mayor_results = data['races'][0]['results']['choiceResults']|sort(attribute='votes', reverse=True) %}

<h3>
    {{'Mayoral race'|upper}}
</h3>
<p style="font-family: sans-serif; color: grey; font-size: 14px;">
    {{data['races'][0]['statistics']['closedPolls']}}/{{data['races'][0]['statistics']['polls']}} polls
</p>
<div style="display: flex; flex-wrap: wrap; justify-content: flex-start;">
    {% for item in mayor_results[0:3] %}
    <div style="min-width: 200px; margin-right: 15px;">
        <h4 style="border-bottom: 1px solid grey; padding-bottom: 0.25rem; margin-bottom: 0.5rem; margin-top: 1rem;">
            {{ loop.index }}. {{ item.choiceName }}
        </h4>
        <p style="margin-top: 0; font-family: sans-serif; color: grey;">
            votes: {{ item.votes }}, {{ item.percentage }}
        </p>
    </div>
    {% endfor %}
</div>

<p>
    <i>Also</i>: 
    {% for item in mayor_results[3:] %}
        {{ loop.index + 3 }}. {{ item.choiceName }} {{ item.votes }} votes, {{ item.percentage }} |   
    {% endfor %}
</p>

<h3>{{'Ward Races'|upper}}</h3>
{% for ward in data['races'][1:15] %}
    <h4>{{ ward.race }}</h4>
    <p style="font-family: sans-serif; color: grey; font-size: 14px;">
        {{ward.statistics.closedPolls}}/{{ward.statistics.polls}} polls
    </p>
    {% set ward_results = ward['results']['choiceResults']|sort(attribute='votes', reverse=True) %}
        {% for item in ward_results[:2] %}
            <p>{{ loop.index }}. {{ item.choiceName }} <span >votes: {{ item.votes }}, {{ item.percentage }}</span></p>
        {% endfor %}
        {% if ward_results|count > 2 %}
            <p>Also: 
                {% for item in ward_results[2:] %}
                {{ loop.index + 2 }}. {{ item.choiceName }} {{ item.votes }} votes, {{ item.percentage }} |   
                {% endfor %}
            </p>
        {% endif %}
{% endfor %}

<h3>{{'Trustee Races'|upper}}</h3>
<h4>{{'Public board'|upper}}</h4>


{% for trustee in data['races'][16:26] %}
<p><b>{{ trustee.race|replace('Hamilton-Wentworth District School Board','HWDSB') }}</b></p>

{% set trustee_results = trustee['results']['choiceResults']|sort(attribute='votes', reverse=True) %}
        {% for item in trustee_results[:2] %}
            <p>{{ loop.index }}.  {{ item.choiceName }} 
            {% if trustee.results.isAcclaimed %}
                <span style="font-family: sans-serif; color: grey; font-size: 14px;">acclaimed</span>
            {% else %}    
                <span style="font-family: sans-serif; color: grey; font-size: 14px;">votes: {{ item.votes }}, {{ item.percentage }}</span>
            {% endif %} 
            
            </p>
        {% endfor %}
        {% if trustee_results|count > 2 %}
            <p><i>Also</i>: 
                {% for item in trustee_results[2:] %}
                {{ loop.index + 2 }}. {{ item.choiceName }} <span style="font-family: sans-serif; color: grey; font-size: 14px;">{{ item.votes }} votes, {{ item.percentage }}</span> |   
                {% endfor %}
            </p>
        {% endif %}

{% endfor %}


<h4>{{'Catholic board'|upper}}</h4>
{% for trustee in data['races'][27:35] %}

<p>{{ trustee.race|replace('Hamilton-Wentworth Catholic District School Board','HWCDSB') }} </p>

{% set trustee_results = trustee['results']['choiceResults']|sort(attribute='votes', reverse=True) %}
        {% for item in trustee_results[:2] %}
            <p>{{ loop.index }}.  {{ item.choiceName }} 
            {% if trustee.results.isAcclaimed %}
                <span style="font-family: sans-serif; color: grey; font-size: 14px;">acclaimed</span>
            {% else %}    
                <span style="font-family: sans-serif; color: grey; font-size: 14px;">votes: {{ item.votes }}, {{ item.percentage }}</span>
            {% endif %} 
            
            </p>
        {% endfor %}
        {% if trustee_results|count > 2 %}
            <p><i>Also</i>: 
                {% for item in trustee_results[2:] %}
                {{ loop.index + 2 }}. {{ item.choiceName }} <span style="font-family: sans-serif; color: grey; font-size: 14px;">{{ item.votes }} votes, {{ item.percentage }}</span> |   
                {% endfor %}
            </p>
        {% endif %}



{% endfor %}

<h4>{{'Other'|upper}}</h4>
{% for trustee in data['races'][-2:] %}
<p>{{ trustee.race }} </p>

{% set trustee_results = trustee['results']['choiceResults']|sort(attribute='votes', reverse=True) %}
        {% for item in trustee_results[:2] %}
            <p>{{ loop.index }}.  {{ item.choiceName }} 
            {% if trustee.results.isAcclaimed %}
                <span style="font-family: sans-serif; color: grey; font-size: 14px;">acclaimed</span>
            {% else %}    
                <span style="font-family: sans-serif; color: grey; font-size: 14px;">votes: {{ item.votes }}, {{ item.percentage }}</span>
            {% endif %} 
            
            </p>
        {% endfor %}
        {% if trustee_results|count > 2 %}
            <p><i>Also</i>: 
                {% for item in trustee_results[2:] %}
                {{ loop.index + 2 }}. {{ item.choiceName }} <span style="font-family: sans-serif; color: grey; font-size: 14px;">{{ item.votes }} votes, {{ item.percentage }}</span> |   
                {% endfor %}
            </p>
        {% endif %}
{% endfor %}

<script type="text/javascript">
    var acc = document.getElementsByClassName("pica-accordion");
var i;

for (i = 0; i < acc.length; i++) {
    acc[i].addEventListener("click", function() {
        /* Toggle between adding and removing the "active" class,
        to highlight the button that controls the panel */
        this.classList.toggle("pica-active");

        /* Toggle between hiding and showing the active panel */
        var panel = this.nextElementSibling;
        if (panel.style.display === "block") {
            panel.style.display = "none";
        } else {
            panel.style.display = "block";
        }
    });
}
</script>

{% endblock %}